/* ********************************************************* *\
|  Micro.js framework made by PDKnight. All rights reserved.  |
|               For more information please visit             |
|             https://github.com/PDKnight/Micro.js.           |
\* ********************************************************* */
"use strict";/*@cc_on @*/Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),s=this,r=function(){},n=function(){return s.apply(this instanceof r?this:t,e.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(r.prototype=this.prototype),n.prototype=new r,n}),"object"!=typeof window.console&&(window.console={log:function(){}}),String.prototype.startsWith||(String.prototype.startsWith=function(t){return 0==this.indexOf(t)}),String.prototype.endsWith||(String.prototype.endsWith=function(t){return this.indexOf(t)==this.length-1-t.length}),String.prototype.escape||(String.prototype.escape=function(){return this.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}),String.prototype.tr||(String.prototype.tr=function(){return this.replace(/^\s*|\s*$/g,"")}),Object.keys||(Object.keys=function(t){var e=[];for(var s in t)t.hasOwnProperty(s)&&e.push(s);return e}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){for(var s=e||0,r=this.length;r>s;s++)if(this[s]===t)return s;return-1});var Micro=new function(){this.e,this.version="1.3";var d=document,sel=function(t,e){return e?d.querySelectorAll(t):d.querySelector(t)},NO_XHR_MSG,XHR_FAILED_MSG,c=sel("*",!0),cs=[],p;for(p=0;p<c.length;p++)c[p].hasAttribute("m-enable")&&cs.push(c[p]);if(cs.length>1)throw new Error("Please use only one element with 'm-enable' attribute!");1==cs.length&&(this.e=cs[0]),NO_XHR_MSG="Error: Your browser can't create an AJAX request. ",XHR_FAILED_MSG="Error: The AJAX failed. Check your console for more information. ";var createXHR=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject){if("string"!=typeof arguments.callee.activeXString)for(var t=["MSXML2.XMLHttp.6.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp"],e=0,s=t.length;s>e;e++)try{var r=new ActiveXObject(t[e]);return arguments.callee.activeXString=t[e],r}catch(n){}return new ActiveXObject(arguments.callee.activeXString)}err(NO_XHR_MSG)},getResponse=function(t,e,s,r){var n=createXHR(s),i="undefined"==typeof r?!0:r;n.onreadystatechange=function(){if(4==n.readyState)if(n.status>=200&&n.status<300||304==n.status){var r=n.responseText;if("undefined"==typeof e)return r;e(r,t)}else s(XHR_FAILED_MSG+"  [status:"+n.status+"]")}.bind(this),n.open("get",t,i),n.send(null)}.bind(this),Core=function(){var t;this.CSSprops=["all","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-shadow","text-shadow","caption-side","clear","clip","color","content","counter-increment","counter-reset","cursor","direction","display","empty-cells","float","font","font-family","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-weight","height","left","letter-spacing","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","max-height","max-width","min-height","min-width","opacity","orphans","outline","outline-color","outline-style","outline-width","overflow","padding","padding-bottom","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","position","quotes","right","table-layout","text-align","text-decoration","text-indent","text-transform","top","transform","transform-origin","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","white-space","widows","width","word-spacing","z-index"],this.C={createElement:function(t){return d.createElement(t)}.bind(this),arrToEl:function(t,e){return el=this.createElement(t[0].replace(/\s+$/,"")),el.innerHTML=t[2],el.innerHTML=el.innerHTML.replace(/(^\n|\n$)/gm,""),e?el.outerHTML:el},error:function(t,e,s){s.innerHTML="Error at line "+t+": "+e}.bind(this)},this.R={ln:1,lns:[],tagRe:/^\s*[a-zA-Z0-9-]+[\s\n]*$/,properties:{remove_spaces_at_start:"on",console_output:"off"},togglable:["remove_spaces_at_start","console_output"],isTogglable:function(t){if("number"!=typeof t)return!1;var e=Object.keys(this.properties);return 0>t||t>=e.length?!1:this.togglable.indexOf(e[t])>-1},check:function(t){var e=this.isTogglable(t);if("number"!=typeof t)return e?!1:"";var s=Object.keys(this.properties);if(0>t||t>=s.length)return!1;var r=this.properties[s[t]];return e?"on"==r||"true"==r:r},gl:function(){return this.R.lns[this.R.ln-1]}.bind(this),lnl:function(){return this.lns.length},hasNext:function(){return this.ln-1<this.lnl()},lineToElement:function(t){var e=this.gl(!0).replace(/\s+[\s\S]*/,"");return t?C.createElement(e):e},read:function(e,s,r){if(0==e.length)return[[1,"text",""]];this.R.lns=e.split(/\n/);for(var n,i,o,a,l,h="";this.R.hasNext();){if(n=this.R.gl(),/^@.+/.test(n)){var p=/^@import\s+([^\s\n]+)\s*$/,c=/^@title\s+(.+)\s*$/,d=/^@favicon\s+(.+)\.(.+)\s*$/;if(d.test(n)){var f=n.match(d),g=f[1],u=f[2],b=sel("link#favicon");b&&(b.hasAttribute("href")?b.getAttribute("href")!=g+"."+u:!0)&&b.remove();var A=document.createElement("link");A.id="favicon",A.rel="icon",A.type="image/"+u,A.href=g+"."+u,document.head.appendChild(A),this.R.ln++;continue}if(p.test(n)){var m=n.match(p)[1];if(!/.+(.css|.js)$/.test(m))return void s("Please import only .css or .js file(s).",this.R.ln);this.A.responses[m.indexOf(".css")==m.length-4?"styles":"scripts"].push(m),this.R.ln++;continue}if(c.test(n)){var y=n.match(c)[1];document.title&&(document.title=y),this.R.ln++;continue}if(/^@[^:]+:\s*.+/.test(n)){if(o=n.split(/:\s*/),a=o[0].replace(/^@/,""),!this.R.properties.hasOwnProperty(a))return void s("Unknown property: "+a+".",this.R.ln);l=o[1].replace(/\s+$/,""),this.R.properties[a]=l,this.R.ln++;continue}}for(this.A.arr.length>0&&this.A.tag_level>0&&this.R.check(0)&&(n=n.replace(/^(\t| {4})/,"")),(0==n.length||13!=n.charCodeAt(n.length-1))&&(n+=this.R.ln!=this.R.lns.length?String.fromCharCode(13):this.A.brackets.started()?String.fromCharCode(10):""),t=0;t<n.length&&(i=n[t],"#"!=i||(t>0?"\\"==n[t-1]:0)||this.A.brackets.started());t++){var v=("%c- "+this.R.ln+", '"+i+"', "+i.charCodeAt(0),this.A.arr);if("("==i&&0==this.A.brackets.level||")"==i&&1==this.A.brackets.level||this.A.brackets.started()||0==v.length&&this.R.tagRe.test(h)&&"("==i){h&&!this.A.brackets.started()&&(this.A.New(["text",h]),h="");var k,w,R="";for(k=v.length-1;k>=0;k--)if(w=v[k],"text"==w[1]){if(this.R.tagRe.test(w[2])){R=w[2];break}if(!/^\s*$/.test(w[2]))break}if(R){this.A.brackets.started()?")"==i||t==n.length-1&&this.R.ln==this.R.lns.length?(this.A.brackets.level--,!this.A.brackets.level||t==n.length-1&&this.R.ln==this.R.lns.length?(this.A.brackets.state=-1,this.A.New(["properties",h+(this.A.brackets.level||")"!=i?i:""),!this.A.brackets.level&&")"==i]),h=""):h+=")"):"("==i?(this.A.brackets.level++,h+="("):h+=13==i.charCodeAt(0)?"\n":i:"("==i&&(this.A.brackets.state=0,this.A.brackets.level++,t==n.length-1&&this.R.ln==this.R.lns.length&&(h+="("));continue}if(this.A.isSpace(h)){this.A.New(["text","("]),h="";continue}}if("]"!=i)if(/^[^\s\n]+[\s\n]+$/.test(h))/[\s\n]/.test(i)?h+=i:"["==i?(this.A.New(["element_start",h.replace(/^\s+|\s+$/g,"")]),h=""):(this.A.New(["text",h]),h=i);else if(this.A.isSpace(h)&&/[a-zA-Z0-9-]/.test(i))this.A.New(["text",h]),h=i;else if(/[a-zA-Z0-9-\s\n]/.test(i))h+=i,t==n.length-1&&(this.A.New(["text",h]),h="",this.A.New(["EOL",""]));else if("\\"==i)h.length>0&&h.endsWith("\\")?h+=i:(this.A.New(["text",h]),h=i);else if("["==i)if(this.R.tagRe.test(h)){var v=this.A.arr;if(/^\s+[a-zA-Z0-9-]+[\s\n]*$/.test(h)){var x=h.match(/^(\s+)/)[1];this.A.New(["text",x]),h=h.replace(/^\s+/,"")}this.A.New(["element_start",h.endsWith("\\")?h.replace(/\\?$|^\s+|\s+$/g,""):h.replace(/^\s+|\s+$/g,"")]),h=""}else{var v=this.A.arr;if(/^\s*$/.test(h)&&(v.length>1?"properties"!=v[v.length-1][1]:1))if(v.length>1){var k,$,_,L,w="",R="";for(k=v.length-1;k>=0;k--)if(w=v[k],"EOL"!=w[1])if("properties"!=w[1]){if("text"!=w[1])break;if(!this.A.isSBracket(w[2])){if(L=!1,this.A.isSpace(w[2])&&k>0){var S,E;for(S=k-1;S>=0;S--)if(E=v[S],"EOL"!=E[1]){if("text"!=E[1])break;if(this.A.isSBracket(E[2])){L=!0;break}if(!this.A.isSpace(E[2])&&!this.R.tagRe.test(E[2]))break}}if(L)break;if(this.R.tagRe.test(w[2])){R=w[2],this.A.arr.splice(k),this.A.properties=_,this.A.New(["element_start",R.replace(/^\s+|\s+$/g,"")]),$=!0;break}}}else _=w[2];$||this.A.New(["text","["])}else this.A.New(["text","["]);else if(v.length>1&&"properties"==v[v.length-1][1]){var k,w,R="";for(k=v.length-1;k>=0;k--)w=v[k],"text"==w[1]&&(this.R.tagRe.test(w[2])?(R=w[2],k=0):k=0);this.A.New(["element_start",""]),h=""}else this.A.New(["text",h]),h="",this.A.New(["element_start",""])}else h?(this.A.New(["text",(h.endsWith("\\")?h.replace(/\\?$/,""):h)+i]),h=""):h+=i;else"\\"!=h?(this.A.New(["text",h]),this.A.New(["element_end",""]),h=""):(this.A.New(["text",i]),h="")}this.R.ln++;var M=this.A.arr;this.A.brackets.started()||(M.length>1?"EOL"==M[M.length-1][1]:0)||(this.A.New(["text",h]),h="",this.A.New(["EOL",""]))}return this.R.ln--,/^[\s\n]*$/.test(h)||this.A.New(["text",h]),this.A.arr}.bind(this)},this.A={isSpace:function(t){return/^[\s\n]*$/.test(t)},tag:"",isTag:function(t){return/^\s*[a-zA-Z0-9-]+[\s\n]*$/.test(t)},isSBracket:function(t){return/^\s*\[[\s\n]*$/.test(t)},banned_tags:["style","script"],components:{menu:["div",'class="menu"'],"menu-brand":["img",'class="menu-brand"'],"menu-item":["a",'class="menu-item"'],clear:["div",'class="clear"'],dark:["div",'class="dark"'],grand:["div",'class="grand"'],"grand-content":["div",'class="grand-content"'],title:["div",'class="title"'],"sub-title":["div",'class="sub-title"'],code:["div",'class="code"'],middle:["div",'class="middle"'],sh:["span",'class="sh"']},responses:{styles:[],scripts:[]},properties:"",closedProperties:!1,pReset:function(){this.properties="",this.closedProperties=!1},propsLine:0,tag_level:0,arr:[],brackets:{started:!1,text:"",state:-1,level:0,append:function(t){this.text+=t},started:function(){return this.state>-1}},tg_level:function(t){return t.length},New:function(t){t.unshift(this.R.ln),this.A.arr.push(t),"element_start"==t[1]&&(this.A.tag_level+=1),this.A.tag_level>0&&"element_end"==t[1]&&(this.A.tag_level-=1)}.bind(this),print:function(t){return"string"==typeof t?"inner: "+t+", tag: "+this.A.tag+", properties: "+this.A.properties+", propsLine: "+this.A.propsLine:this.A.arr}.bind(this),hasNextElementWithVal:function(t,e,s,r){if(t.length<2||e>=t.length-2)return!1;var n;for(n=e+1;kk=t[n];n++)if(!("EOL"==kk[1]||"text"==kk[1]&&/^[\s\n]*$/.test(kk[2]))&&new RegExp(r).test(kk[s]))return!0;return!1},isNearElement:function(t,e,s){if(t.length<2||e>=t.length-2)return!1;var r,n;for(r=e+1;n=t[r];r++)if("EOL"!=n[1]&&(s?"properties"!=n[1]:1)){if("text"==n[1]){if(/^[^\\]*\]$/.test(n[2]))break;if(/^[\s\n]*$/.test(n[2]))continue;if(/^\s*\[$/.test(n[2]))return!0;break}if("element_start"==n[1]){if(this.isSpace(n[2]))return!0;break}if("element_end"==n[1])break}return!1},isBeforeElement:function(t,e){if(t.length<2&&2>e)return!1;var s,r;for(s=e-1;s>=0;s--)if(r=t[s],"EOL"!=r[1]&&"properties"!=r[1]){if("text"==r[1]){if(this.isTag(r[2]))return!0;if(this.isSpace(r[2]))continue;break}break}return!1},readProperties:function(t,e,s,r){if(/^[\s\n]*$/.test(t))return null;var n,i,o,a,l,h,p={},c={},d=t.split("\n");for(n=0;n<d.length;n++)if(i=d[n],!/^[\s\n]*$/.test(i)){if(!/^\s*[^:]+\s*:\s*.+\s*$/.test(i))return s("Wrong syntax. Use pattern -> property: value.",e-d.length+n+1),"err";if(a=i.split(/\s*:\s*/),h=a[1],a.length>2)for(var f=2;f<a.length;f++)h+=":"+a[f];if(l=a[0].replace(/^\s+|\s+$/,"").toLowerCase(),h=h.replace(/^\s+|\s+$/,""),!/^\!?[a-zA-Z0-9-]+$/.test(l))return s("Unsupported property syntax: "+l+".",e-d.length+n+1),"err";!l.startsWith("!")&&this.CSSprops.indexOf(l)>-1?c[l]=h:p[l.replace(/^\!/,"")]=h}if(!r)return p;var g=Object.keys(p),u=Object.keys(c),b="",A="";if(u.length>0)for(n=0;n<u.length;n++)i=u[n],o=c[i],A+=i+":"+o+(n==u.length-1?"":";");for(b+=0==A.length?"":' style="'+A+'"',n=0;n<g.length;n++)i=g[n],o=p[i],b+=" "+i+'="'+o+'"';return b}.bind(this),together:function(e,s){if(!s)return"";var r,n=this.A.print(),i="",o=[];for(t=0;r=n[t];t++){var a=r[1],l=r[2];switch("text"==a&&!/(^\s*\[$|^[\s\n]*$)/.test(l)&&/^\s*[a-zA-Z0-9-]+\s*$/.test(l)||"element_start"==a&&!/^[\s\n]*$/.test(l)?this.A.tag=l:"properties"==a||/(^\s*\[$|^[\s\n]*$)/.test(l)||(this.A.tag=""),"properties"==a?(this.A.properties=l,this.A.closedProperties=r[3],this.A.propsLine=r[0]):"text"!=a||/[^\[]*\[$/.test(l)||/[\s\n]*/.test(l)||this.A.pReset(),a){case"element_start":var h=this.A.tag,p=h.tr(),c=RegExp("("+h+")((<br>|\\s|\\n)*)$"),d=this.A.components,f="",g=this.A.properties;if((o.length>0?RegExp("<"+o[o.length-1]+"\\s*(\\s*[a-zA-Z0-9-]+\\s*=\\s*(\"[^\"]*\"|'[^']*'))*$").test(i):!1)&&(i+=">"),this.A.banned_tags.indexOf(p)>-1)return void e("Unsupported element: "+p+".",r[0]);if(d.hasOwnProperty(p)&&(f=" "+d[p][1],p=d[p][0]),/^[\s\n]*$/.test(l)||g||o.push(p),!h)break;if(!this.A.isTag(p)){i+=c.test(i)?"":h+"[",this.A.tag="",this.A.pReset();break}if(t>0&&"element_start"==n[t-1][1]&&/^\s*$/.test(n[t-1][2])&&(i+="["),g){var u=i.replace(c,"");i=u,i+="<"+p+f,o.push(p);var b=this.A.readProperties(g,this.A.propsLine,e,!0);if("err"==b)return;i+=null==b?"":b,this.A.pReset();continue}0==l.length?RegExp("<"+o[o.length-1]+"\\s*(\\s*[a-zA-Z0-9-]+\\s*=\\s*(\"[^\"]*\"|'[^']*'))*>$").test(i)||(i+="<"+p+f,o.push(p)):i+="<"+p+f,this.A.tag=p;break;case"properties":if(t<n.length-1){var A,m;for(A=t+1;A<n.length;A++)if(m=n[A],!("EOL"==m[1]||"text"==m[1]&&/^\s*$/.test(m[2]))){if("properties"==m[1]){var y=r[3],v=!1,k=Micro.read(l,!1,!1,function(t,e){e=e||"unknown",v="Error at line "+e+": "+t});if(i+="("+k+(y?")":""),v)return v;break}break}}break;case"text":var w=/(^\s*\[$|^[\s\n]*$)/,R=this.A.isNearElement(n,t,!0);if(l=l.replace(/[<>]/g,function(t){switch(t){case"<":return"&lt;";case">":return"&gt;"}}),t>1&&(this.A.properties||(t>0?"properties"==n[t-1][1]:!1))){var g=this.A.properties;if(this.A.isNearElement(n,t)&&/^(<br>|\s|\n)*$/.test(l))continue;var v=!1,k=s.read(g+(g.split("\n").length>1,""),!1,!1,function(t,e){e=e||"unknown",v="Error at line "+e+": "+t}),x="("+k+(this.A.closedProperties?")":"");if(v)return v;(o.length>0?RegExp("<"+o[o.length-1]+"\\s*(\\s*[a-zA-Z0-9-]+\\s*=\\s*(\"[^\"]*\"|'[^']*'))*$").test(i):!1)&&(i+=">"),i+=x,this.A.pReset()}else!this.A.isBeforeElement(n,t)&&(t>0&&o.length>0?"element_start"==n[t-1][1]||"text"==n[t-1][1]&&/^\s*\[[\s\n]*$/.test(n[t-1][2]):!0)&&((o.length>0?RegExp("<"+o[o.length-1]+"\\s*(\\s*[a-zA-Z0-9-]+\\s*=\\s*(\"[^\"]*\"|'[^']*'))*$").test(i):!1)?(i+=">"+(/^\s*\[[\s\n]*$/.test(l)?"[":""),this.A.tag="",this.A.pReset()):(/^\s*\[[\s\n]*$/.test(l)||(t>0?"element_start"==n[t-1][1]&&/^\s*$/.test(n[t-1][2]):!1))&&(i+="[",this.A.tag="",this.A.pReset()));i+=t<n.length-1&&!l.endsWith("\\")&&"]"!=n[t+1][2]&&n.length>1?this.A.isSpace(l)?l:R&&this.R.tagRe.test(l)?"":o.length>0?!RegExp("<"+o[o.length-1]+"\\s*(\\s*[a-zA-Z0-9-]+\\s*=\\s*(\"[^\"]*\"|'[^']*'))*>$").test(i)&&w.test(l)?"":l:t>0?/^\s*\[[\s\n]*$/.test(l)?"element_start"==n[t-1][1]?l:"":l:/^\s*\[[\s\n]*$/.test(l)?"":l:/\\+/.test(l)?l:l.replace(/\\+$/,"");break;case"EOL":var $=this.A.isNearElement(n,t);if($&&this.A.tag)break;(t>0?"element_start"==n[t-1][1]||"element_end"==n[t-1][1]:0)||(t>1&&o.length>0?"element_end"!=n[t-2][1]&&"element_start"!=n[t-2][1]?$:1:0)||t==n.length-1||(i+="<br>");break;case"element_end":if(0==o.length)return void e("There's an unwanted closing parenthesis in your .mi file.",this.R.ln);i+="</"+o[o.length-1]+">",o.pop(),this.A.tag=""}}return i}.bind(this)}};if(this.read=function(t,e,s,r){var n=(new Date).getTime(),i=!1;r||(r=function(t,e){e=e||"unknown",i="Error at line "+e+": "+t});var o=new Core,a=o.R.read(t,r,this.version);if(s)return a;var l=o.A.together(r,this),h=(new Date).getTime(),p=i?i:l;return e?[h-n,p,o.A.responses]:p},this.render=function(r,el,el2){if(r){el||(el=this.e);var inn=this.read(r,!0),responses=inn[2],k,kk,l,ll,innerMatch=el.innerHTML.match(/[\s\S]+(?=(<style\s*(?:\s*[a-zA-Z0-9-]+\s*=\s*(?:\"[^\"]*\"|'[^']*'))*>[\s\S]+<\/style>.*|<script\s*(?:\s*[a-zA-Z0-9-]+\s*=\s*(?:\"[^\"]*\"|'[^']*'))*>[\s\S]+<\/script>.*))/),dd;if(el2&&(el2.innerHTML=inn[0]+"ms"),null!=innerMatch){dd=document.createElement("div"),dd.innerHTML=innerMatch[1];var styles=dd.querySelectorAll("style"),ddInner="";if(responses&&responses.styles.length>0)for(l=0;l<styles.length;l++)styles[l].hasAttribute("id")&&responses.styles.indexOf(styles[l].id)>-1&&(ddInner+=styles[l].outerHTML);dd.innerHTML=ddInner}if(el.style.display="none",el.innerHTML=inn[1],dd)return el.innerHTML+=dd.innerHTML,void(el.style.display="");if(responses){if(responses.styles.length>0)for(k=0;kk=responses.styles[k];k++)getResponse(kk,function(t,e){el.innerHTML+='<style id="'+e+'">'+t+"</style>",0==responses.scripts.length&&k==responses.styles.length&&(el.style.display="")},function(t){el.innerHTML=t},!0);if(responses.scripts.length>0)for(k=0;kk=responses.scripts[k];k++)getResponse(kk,function(r){eval(r),k==responses.scripts.length&&(el.style.display="")},function(t){el.innerHTML=t},!0)}(!responses||0==responses.styles.length&&0==responses.scripts.length)&&(el.style.display="")}},"undefined"!=typeof this.e){var link=this.e.getAttribute("m-enable");"this"==link?this.render(this.e.innerHTML.replace(/&amp;/g,"&"),this.e):getResponse(link+".mi",function(t){this.render(t)}.bind(this),function(t){this.e.innerHTML=t}.bind(this),!0)}};
